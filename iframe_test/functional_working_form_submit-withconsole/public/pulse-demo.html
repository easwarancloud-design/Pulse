<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Pulse iframe Integration Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .demo-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .demo-title {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .iframe-container {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .iframe-small {
            width: 100%;
            height: 250px;
            border: none;
        }
        
        .iframe-large {
            width: 100%;
            height: 400px;
            border: none;
        }
        
        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .info-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
        }
        
        .features-list li {
            padding: 8px 0;
            position: relative;
            padding-left: 20px;
        }
        
        .features-list li:before {
            content: "âœ“";
            color: #27ae60;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        /* Enhanced Dropdown Overlay Styles */
        .pulse-dropdown-overlay {
            position: fixed;
            z-index: 10000;
            background: linear-gradient(115deg, #122F65 2.06%, #00123C 97.35%);
            border: 2px solid #2861BB;
            border-radius: 16px;
            padding: 12px 16px;
            box-shadow: 0px 8px 32px 0px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            max-height: 320px;
            overflow-y: auto;
            min-width: 300px;
            display: none;
            animation: slideIn 0.2s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-dropdown-header {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            padding-bottom: 8px;
            font-size: 13px;
            font-family: 'Elevance Sans', -apple-system, Roboto, Helvetica, sans-serif;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .pulse-dropdown-item {
            display: flex;
            align-items: center;
            padding: 10px 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 2px;
            min-height: 36px;
            border-radius: 6px;
        }
        
        .pulse-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(2px);
        }
        
        .pulse-dropdown-icon {
            width: 16px;
            height: 16px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .pulse-dropdown-text {
            color: white;
            font-size: 14px;
            line-height: 18px;
            font-family: 'Elevance Sans', -apple-system, Roboto, Helvetica, sans-serif;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }
        
        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .demo-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .demo-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>Pulse iframe Integration Demo</h1>
        <p>Demonstrating seamless iframe integration with breakout dropdown functionality</p>
    </div>
    
    <div class="demo-container">
        <!-- Small Widget Style -->
        <div class="demo-card">
            <div class="demo-title">Compact Widget Mode</div>
            <div class="iframe-container">
                <div class="status-indicator">Live</div>
                <iframe 
                    src="http://localhost:3002/pulseembedded" 
                    class="iframe-small"
                    id="pulseIframe1"
                    name="pulseIframe1">
                </iframe>
            </div>
            <div class="info-panel">
                <strong>Perfect for:</strong> Sidebars, dashboards, compact spaces
                <ul class="features-list">
                    <li>Dropdown breaks out of frame</li>
                    <li>Full search functionality</li>
                    <li>Seamless parent navigation</li>
                </ul>
            </div>
        </div>

        <!-- Standard Integration -->
        <div class="demo-card">
            <div class="demo-title">Standard Integration</div>
            <div class="iframe-container">
                <div class="status-indicator">Live</div>
                <iframe 
                    src="http://localhost:3002/pulseembedded" 
                    class="iframe-large"
                    id="pulseIframe2"
                    name="pulseIframe2">
                </iframe>
            </div>
            <div class="info-panel">
                <strong>Perfect for:</strong> Main content areas, dedicated search sections
                <ul class="features-list">
                    <li>Full visual experience</li>
                    <li>Complete feature set</li>
                    <li>Optimized user flow</li>
                </ul>
            </div>
        </div>

        <!-- Integration Guide -->
        <div class="demo-card full-width">
            <div class="demo-title">Integration Guide & Features</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div>
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">ðŸš€ Key Features</h4>
                    <ul class="features-list">
                        <li>Dropdown breaks iframe boundaries</li>
                        <li>Smart back navigation</li>
                        <li>URL parameter support</li>
                        <li>Cross-origin communication</li>
                        <li>Responsive design</li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">ðŸ”§ Integration Code</h4>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto;"><code>&lt;iframe 
  src="http://localhost:3002/pulseembedded"
  width="100%" 
  height="400px"
  frameborder="0"&gt;
&lt;/iframe&gt;</code></pre>
                </div>
                <div>
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">ðŸ§ª Test Scenarios</h4>
                    <ul class="features-list">
                        <li>Focus search input</li>
                        <li>Type to filter suggestions</li>
                        <li>Click dropdown items</li>
                        <li>Test search breakout</li>
                        <li>Verify back navigation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Dropdown overlay container -->
    <div id="pulseDropdownOverlay" class="pulse-dropdown-overlay"></div>

    <script>
        // Enhanced dropdown management with support for multiple iframes
        const dropdownOverlay = document.getElementById('pulseDropdownOverlay');
        let currentActiveIframe = null;
        
        // Listen for messages from any iframe
        window.addEventListener('message', function(event) {
            // Verify origin for security
            if (event.origin !== 'http://localhost:3002') return;
            
            const { type, data } = event.data;
            
            if (type === 'PULSE_SHOW_DROPDOWN') {
                showDropdown(data, event.source);
            } else if (type === 'PULSE_HIDE_DROPDOWN') {
                hideDropdown();
            }
        });
        
        function showDropdown(data, iframeWindow) {
            const { suggestions, position } = data;
            
            // Find which iframe sent the message
            const iframes = document.querySelectorAll('iframe');
            let sourceIframe = null;
            
            for (let iframe of iframes) {
                if (iframe.contentWindow === iframeWindow) {
                    sourceIframe = iframe;
                    break;
                }
            }
            
            if (!sourceIframe) return;
            
            currentActiveIframe = iframeWindow;
            
            // Calculate position relative to the specific iframe
            const iframeRect = sourceIframe.getBoundingClientRect();
            const dropdownX = iframeRect.left + position.x;
            const dropdownY = iframeRect.top + position.y + 8; // 8px gap
            
            // Clear existing content
            dropdownOverlay.innerHTML = '';
            
            // Create header
            const header = document.createElement('div');
            header.className = 'pulse-dropdown-header';
            header.textContent = 'Previous Conversations';
            dropdownOverlay.appendChild(header);
            
            // Create dropdown items
            suggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'pulse-dropdown-item';
                
                // Chat icon (SVG)
                const icon = document.createElement('div');
                icon.className = 'pulse-dropdown-icon';
                icon.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 2H4C2.9 2 2 2.9 2 4V18L6 14H20C21.1 14 22 13.1 22 12V4C22 2.9 21.1 2 20 2Z" fill="#87D2F7"/>
                    </svg>
                `;
                
                // Text content
                const text = document.createElement('div');
                text.className = 'pulse-dropdown-text';
                text.textContent = suggestion.title;
                
                item.appendChild(icon);
                item.appendChild(text);
                
                // Click handler
                item.addEventListener('click', function() {
                    // Send selection back to the specific iframe
                    currentActiveIframe.postMessage({
                        type: 'PULSE_DROPDOWN_SELECTION',
                        data: suggestion
                    }, 'http://localhost:3002');
                    
                    hideDropdown();
                });
                
                dropdownOverlay.appendChild(item);
            });
            
            // Position and show dropdown with bounds checking
            const maxX = window.innerWidth - 320; // dropdown min-width
            const maxY = window.innerHeight - 320; // dropdown max-height
            
            const finalX = Math.min(dropdownX, maxX);
            const finalY = Math.min(dropdownY, maxY);
            
            dropdownOverlay.style.left = finalX + 'px';
            dropdownOverlay.style.top = finalY + 'px';
            dropdownOverlay.style.width = Math.max(position.width, 300) + 'px';
            dropdownOverlay.style.display = 'block';
        }
        
        function hideDropdown() {
            dropdownOverlay.style.display = 'none';
            currentActiveIframe = null;
        }
        
        // Hide dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!dropdownOverlay.contains(event.target)) {
                const clickedOnIframe = Array.from(document.querySelectorAll('iframe')).some(iframe => {
                    const rect = iframe.getBoundingClientRect();
                    return event.clientX >= rect.left && event.clientX <= rect.right &&
                           event.clientY >= rect.top && event.clientY <= rect.bottom;
                });
                
                if (!clickedOnIframe) {
                    hideDropdown();
                }
            }
        });
        
        // Hide dropdown on scroll
        window.addEventListener('scroll', hideDropdown);
        
        // Hide dropdown on window resize
        window.addEventListener('resize', hideDropdown);
        
        console.log('ðŸš€ Pulse iframe integration demo ready!');
        console.log('ðŸ’¡ Try focusing the search input in any iframe to see the breakout dropdown');
    </script>
</body>
</html>